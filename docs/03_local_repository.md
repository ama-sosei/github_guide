# ローカルリポジトリを使う
この章では以下のことについて説明しています。  
- ローカルリポジトリの作成
- ステージング
- コミット
- 取り消し操作
  - ワークツリーの変更の取り消し
  - ステージングの取り消し
  - コミットの取り消し
- ファイルの差分の確認


## リポジトリとは
ファイルの変更履歴を含むバージョン管理に必要になる様々な情報を保持する場所をリポジトリと呼びます。  
ローカルリポジトリは手元のパソコン内に作成するリポジトリのことです。  
後ほど使いますがリモートリポジトリと呼ばれるリポジトリもあり、一般的には複数人で共有することを目的にサーバー上に作られます。  

## Gitで管理するファイルを作成する
### ワークツリーを作成する
ワークツリーはGitで管理したいファイルを配置するディレクトリのことです。  
本稿ではディレクトリは`git_learning`としホームディレクトリ直下に作成します。  
以下コマンドを用いることでディレクトリを作成する事ができます。  

```bash
~/ $ cd ~/
~/ $ mkdir git_learning
```    

### 管理するファイルを作成する
```bash
~/git_learning/ $ echo "# github learning" > README.md
```
上記コマンドで「`# github learning`」が書き込まれたファイル(README.md)を作成することができます。  

## ローカルリポジトリを作成する
`git init`コマンドでローカルリポジトリを作成することができます。  
作業ディレクトリにローカルリポジトリが作成されるため`~/git_learning/`に移動してから実行してください。

```bash
~/git_learning/ $ git init
```

ディレクトリの内容を確認できるコマンドに`ls`コマンドがあります。  
隠しファイルも表示するために`ls -a`を実行すると`.git`ディレクトリが確認できると思います。  
`.git`ディレクトリ内にGitが管理するデータが含まれるので削除しないよう気をつけてください。

## ローカルリポジトリの状態を確認する
`git status`コマンドを用いることでローカルリポジトリの状態を確認することができます。  
以下が`git status`の実行結果です。  
```~/git_learning/ $ git status
On branch master

No commits yet

Untracked files:
  (use "git add <file>..." to include in what will be committed)
        README.md

nothing added to commit but untracked files present (use "git add" to track)
```

### git statusの見方
`On branch master`  
masterブランチで作業していることを表します。ブランチについては、後ほど解説するので詳しくは割愛します。  
`No commits yet`  
一度もコミットしてない場合に表示されます。  
`Untracked files:`  
一度も管理対象になってないファイルを表示しています。  

## ファイルをコミットする
ファイルの変更履歴を保存することをコミットすると呼び、変更記録自体もコミットと呼びます。  
日時や変更したユーザーを含めたコミットには、コミットメッセージを付加することができます。コミットメッセージは、そのコミットで何を変更したのかを説明します。  

コミットする為にステージングと呼ばれる作業を行う必要があります。  
ステージングとは、ファイルの現在の状態を次のコミットに含めることです。  
ステージングされたファイル郡はステージングエリアに保存されます。  

次のコマンドを用いて`README.md`をステージングします。 

```bash 
git add README.md
```

ステージング後の変更はコミットに反映されないので注意してください。  

ステージングされたか`git status`コマンドを用いて確認してみましょう。以下のような表示に変わっていればステージングできています。  
```On branch master

No commits yet

Changes to be committed:
  (use "git rm --cached <file>..." to unstage)
        new file:   README.md
```  


コミットする準備を終えたので、早速コミットしましょう。  

```bash 
git commit -m "コミットメッセージ"
```

ここでは`初めてのコミット`をコミットメッセージにします。  

もう一度、`git status`を使って確認してましょう。  
```On branch master
nothing to commit, working tree clean
```  
これは全ての変更がコミットされ、ワーキングツリーとコミットに相違がないことをあらわしています。  

## ローカルリポジトリでの操作を取り消す
### ワークツリーの変更取り消す
ワークツリーの変更を取り消すには`git checkout`コマンドを使います。  

#### 一部のファイルだけ戻す場合
`git checkout -- <file>`

以下のように指定したディレクトリ以下を再帰的に戻すことも可能です。
`git checkout -- <directly>`  


#### 使ってみる
`README.md`を変更してから最後のコミットに戻します。

```bash
echo "## 変更部分" >> README.md
git checkout -- README.md
```
`echo`でREADME.mdに書き出されて`git checkout`で元に戻ったことが確認できたと思います。  

### ステージングを取り消す
ステージングを取り消すには`git reset`コマンドを使います。  

#### 一部のファイルだけステージングを取り消す場合
`git reset <file>`  

#### 全てのステージングを取り消す場合
`git reset`

ファイルを指定しなければ全てのステージングを取り消す事ができます。

#### 使ってみる
ひとまず、コミットしないファイルを作成し、ステージングします。  
```
~/git_learning/ $ echo > remove.md
~/git_learning/ $ git add remove.md
```  
`git status`コマンドでステージングできた事を確認したら`git reset`コマンドを用いて取り消します。  
`git reset remove.md`  
コマンド実行後、取り消せた事を`git status`で確認してください。  

以降必要ないので`rm remove.md`で`remove.md`は削除しましょう。  

### コミットを取り消す
#### 直前のコミットだけを取り消す
コミットのみを取り消しステージングエリアやワークツリーは、一切変更したくない場合に用いります。  
`git reset --soft HEAD^`  

##### `HEAD`って何？
大抵は最後のコミットを表し`HEAD^`で2つ前のコミットを表します。  
同じように`HEAD^^^`で4つ前のコミットを表しますが`HEAD~3`のように表記することもできます。  
`HEAD`のかわりにコミットハッシュを用いても同じです。  

#### コミットとステージングを取り消す
コミットとステージングを取り消しますが、ワークツリーは変更されません。
`git reset --mixed HEAD^`  

#### コミット,ステージング,ワークツリーを取り消す
ワークツリーも元に戻します。  
`git reset --hard HEAD^`  

ちなみに`git reset --hard HEAD`でステージングや作業ツリー全体の変更を最後のコミットまで戻すことができます。  


## ファイルの差分を確認する
ファイルの修正前と修正後の違いを差分と言います。  
差分を確認するには`git diff`コマンドを使います。  


### 差分を確認するファイルを用意する
`README.md`に変更を加えます。
```bash
~/git_learning/ $ echo "## ここは差分" >> README.md
```

### ステージングエリアとワークツリーの差分を確認する
`git diff`コマンドを実行して差分を確認してみましょう。  

```bash
~/git_learning/ $ git diff
diff --git a/README.md b/README.md
index e03ba55..cc7cd82 100644
--- a/README.md
+++ b/README.md
@@ -1,2 +1,3 @@
 "# github learning"
 "## devでの変更"
+"## ここは差分"
```  
`+`から始まる行が追記された行です。  

### コミットとワークツリーの差分確認
`git diff <<コミット>>`  
コミットを表すものであればなんでもおｋです。  
例
- HEAD
- master
- dev
- コミットハッシュ


[目次へ](../README.md)
